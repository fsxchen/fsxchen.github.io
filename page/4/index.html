<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="CouCou&#39;s Blog">
<meta property="og:url" content="http://fsxchen.github.io/page/4/index.html">
<meta property="og:site_name" content="CouCou&#39;s Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CouCou&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://fsxchen.github.io/page/4/"/>





  <title>CouCou's Blog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CouCou's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/04/27/python/2016_04_27_python实现python解释器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/27/python/2016_04_27_python实现python解释器/" itemprop="url">python实现python解释器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-27T15:55:00+08:00">
                2016-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/04/27/python/2016_04_27_python实现python解释器/" class="leancloud_visitors" data-flag-title="python实现python解释器">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Python实现的Python解释器"><a href="#Python实现的Python解释器" class="headerlink" title="Python实现的Python解释器"></a>Python实现的Python解释器</h1><p>原文地址<br><a href="https://github.com/aosabook/500lines/blob/b5ee54148551b2e71991cf0a4858d86b671f6e52/interpreter/interpreter.markdown" target="_blank" rel="external">https://github.com/aosabook/500lines/blob/b5ee54148551b2e71991cf0a4858d86b671f6e52/interpreter/interpreter.markdown</a></p>
<p><a href="https://github.com/aosabook/500lines" target="_blank" rel="external">项目直达</a><br>这是一个500行实现的一个例子.<br><a href="http://qingyunha.github.io/taotao/" target="_blank" rel="external">该文章的中文翻译地址</a></p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><code>Byterun</code> is a Python interpreter implemented in Python. Through my work on Byterun, I was surprised and delighted to discover that the fundamental structure of the Python interpreter fits easily into the 500-line size restriction. This chapter will walk through the structure of the interpreter and give you enough context to explore it further. The goal is not to explain everything there is to know about interpreters—like so many interesting areas of programming and computer science, you could devote years to developing a deep understanding of the topic.</p>
<p>Byterun was written by Ned Batchelder and myself, building on the work of Paul Swartz. Its structure is similar to the primary implementation of Python, CPython, so understanding Byterun will help you understand interpreters in general and the CPython interpreter in particular. (If you don’t know which Python you’re using, it’s probably CPython.) Despite its short length, Byterun is capable of running most simple Python programs[^versions].</p>
<p>[^versions]: This chapter is based on bytecode produced by Python 3.5 or earlier, as there were some changes to the bytecode specification in Python 3.6.</p>
<h2 id="Python解释器"><a href="#Python解释器" class="headerlink" title="Python解释器"></a>Python解释器</h2><p>解释器: 指的就是REPL(A read–eval–print loop )</p>
<p>在解释器接手之前，Python会执行其他3个步骤：词法分析，语法解析和编译。这三步合起来把源代码转换成code object,它包含着解释器可以理解的指令。而解释器的工作就是解释code object中的指令。</p>
<h2 id="A-Python-Python-Interpreter"><a href="#A-Python-Python-Interpreter" class="headerlink" title="A Python Python Interpreter"></a>A Python Python Interpreter</h2><p>gcc就是C语言写的</p>
<h2 id="Building-an-Interpreter"><a href="#Building-an-Interpreter" class="headerlink" title="Building an Interpreter"></a>Building an Interpreter</h2><p>Python解释器是一个虚拟机,模拟真实计算机的软件。我们这个虚拟机是栈机器，它用几个栈来完成操作（与之相对的是寄存器机器，它从特定的内存地址读写数据）。<br>Python解释器是一个字节码解释器：它的输入是一些命令集合称作字节码。当你写Python代码时，词法分析器，语法解析器和编译器生成code object让解释器去操作。每个code object都包含一个要被执行的指令集合 — 它就是字节码 — 另外还有一些解释器需要的信息。字节码是Python代码的一个中间层表示：它以一种解释器可以理解的方式来表示源代码。这和汇编语言作为C语言和机器语言的中间表示很类似。</p>
<h2 id="A-Tiny-Interpreter"><a href="#A-Tiny-Interpreter" class="headerlink" title="A Tiny Interpreter"></a>A Tiny Interpreter</h2><p>理解3个指令<br><code>LOAD_VALUE</code><br><code>ADD_TOW_VALUE</code><br><code>PRINT_ANSWER</code></p>
<p>假设你输入的是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">7+5</div></pre></td></tr></table></figure></p>
<p>生成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">what_to_execute = &#123;</div><div class="line">    &quot;instructions&quot;: [(&quot;LOAD_VALUE&quot;, 0),  # the first number</div><div class="line">                     (&quot;LOAD_VALUE&quot;, 1),  # the second number</div><div class="line">                     (&quot;ADD_TWO_VALUES&quot;, None),</div><div class="line">                     (&quot;PRINT_ANSWER&quot;, None)],</div><div class="line">    &quot;numbers&quot;: [7, 5] &#125;</div></pre></td></tr></table></figure></p>
<p>Python解释器是一个栈机器，所以它必须通过操作栈来完成这个加法。(Figure 1.1)解释器先执行第一条指令，LOAD_VALUE，把第一个数压到栈中。接着它把第二个数也压到栈中。然后，第三条指令，ADD_TWO_VALUES,先把两个数从栈中弹出，加起来，再把结果压入栈中。最后一步，把结果弹出并输出。</p>
<p><img src="http://7xrn62.com1.z0.glb.clouddn.com/a2e07f8d634f98373fe498bd2a9e8ae5.png" alt="栈机器"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">class Interpreter:</div><div class="line">    def __init__(self):</div><div class="line">        self.stack = []</div><div class="line"></div><div class="line">    def LOAD_VALUE(self, number):</div><div class="line">        self.stack.append(number)</div><div class="line"></div><div class="line">    def PRINT_ANSWER(self):</div><div class="line">        answer = self.stack.pop()</div><div class="line">        print(answer)</div><div class="line"></div><div class="line">    def ADD_TWO_VALUES(self):</div><div class="line">        first_num = self.stack.pop()</div><div class="line">        second_num = self.stack.pop()</div><div class="line">        total = first_num + second_num</div><div class="line">        self.stack.append(total)</div></pre></td></tr></table></figure>
<p>上面3个方法完成了解释器的3个指令.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">def run_code(self, what_to_execute):</div><div class="line">       instructions = what_to_execute[&quot;instructions&quot;]</div><div class="line">       numbers = what_to_execute[&quot;numbers&quot;]</div><div class="line">       for each_step in instructions:</div><div class="line">           instruction, argument = each_step</div><div class="line">           if instruction == &quot;LOAD_VALUE&quot;:</div><div class="line">               number = numbers[argument]</div><div class="line">               self.LOAD_VALUE(number)</div><div class="line">           elif instruction == &quot;ADD_TWO_VALUES&quot;:</div><div class="line">               self.ADD_TWO_VALUES()</div><div class="line">           elif instruction == &quot;PRINT_ANSWER&quot;:</div></pre></td></tr></table></figure>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">what_to_execute = &#123;</div><div class="line">        &quot;instructions&quot;: [(&quot;LOAD_VALUE&quot;, 0),</div><div class="line">                         (&quot;STORE_NAME&quot;, 0),</div><div class="line">                         (&quot;LOAD_VALUE&quot;, 1),</div><div class="line">                         (&quot;STORE_NAME&quot;, 1),</div><div class="line">                         (&quot;LOAD_NAME&quot;, 0),</div><div class="line">                         (&quot;LOAD_NAME&quot;, 1),</div><div class="line">                         (&quot;ADD_TWO_VALUES&quot;, None),</div><div class="line">                         (&quot;PRINT_ANSWER&quot;, None)],</div><div class="line">        &quot;numbers&quot;: [1, 2],</div><div class="line">        &quot;names&quot;:   [&quot;a&quot;, &quot;b&quot;] &#125;</div></pre></td></tr></table></figure>
<p>变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">class Interpreter:</div><div class="line">    def __init__(self):</div><div class="line">        self.stack = []</div><div class="line">        self.environment = &#123;&#125;</div><div class="line"></div><div class="line">    def STORE_NAME(self, name):</div><div class="line">        val = self.stack.pop()</div><div class="line">        self.environment[name] = val</div><div class="line"></div><div class="line">    def LOAD_NAME(self, name):</div><div class="line">        val = self.environment[name]</div><div class="line">        self.stack.append(val)</div><div class="line"></div><div class="line">    def parse_argument(self, instruction, argument, what_to_execute):</div><div class="line">        &quot;&quot;&quot; Understand what the argument to each instruction means.&quot;&quot;&quot;</div><div class="line">        numbers = [&quot;LOAD_VALUE&quot;]</div><div class="line">        names = [&quot;LOAD_NAME&quot;, &quot;STORE_NAME&quot;]</div><div class="line"></div><div class="line">        if instruction in numbers:</div><div class="line">            argument = what_to_execute[&quot;numbers&quot;][argument]</div><div class="line">        elif instruction in names:</div><div class="line">            argument = what_to_execute[&quot;names&quot;][argument]</div><div class="line"></div><div class="line">        return argument</div><div class="line"></div><div class="line">    def run_code(self, what_to_execute):</div><div class="line">        instructions = what_to_execute[&quot;instructions&quot;]</div><div class="line">        for each_step in instructions:</div><div class="line">            instruction, argument = each_step</div><div class="line">            argument = self.parse_argument(instruction, argument, what_to_execute)</div><div class="line"></div><div class="line">            if instruction == &quot;LOAD_VALUE&quot;:</div><div class="line">                self.LOAD_VALUE(argument)</div><div class="line">            elif instruction == &quot;ADD_TWO_VALUES&quot;:</div><div class="line">                self.ADD_TWO_VALUES()</div><div class="line">            elif instruction == &quot;PRINT_ANSWER&quot;:</div><div class="line">                self.PRINT_ANSWER()</div><div class="line">            elif instruction == &quot;STORE_NAME&quot;:</div><div class="line">                self.STORE_NAME(argument)</div><div class="line">            elif instruction == &quot;LOAD_NAME&quot;:</div><div class="line">                self.LOAD_NAME(argument)</div></pre></td></tr></table></figure>
<p>可以看到run_code的方法已经很冗长了.使用python的动态方法查找</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">def execute(self, what_to_execute):</div><div class="line">    instructions = what_to_execute[&quot;instructions&quot;]</div><div class="line">    for each_step in instructions:</div><div class="line">       instruction, argument = each_step</div><div class="line">       argument = self.parse_argument(instruction, argument, what_to_execute)</div><div class="line">       bytecode_method = getattr(self, instruction)</div><div class="line">       if argument is None:</div><div class="line">           bytecode_method()</div><div class="line">       else:</div><div class="line">           bytecode_method(argument)</div></pre></td></tr></table></figure>
<h2 id="Real-Python-Bytecode"><a href="#Real-Python-Bytecode" class="headerlink" title="Real Python Bytecode"></a>Real Python Bytecode</h2><p>python字节码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; def cond():</div><div class="line">...     x = 3</div><div class="line">...     if x &lt; 5:</div><div class="line">...         return &apos;yes&apos;</div><div class="line">...     else:</div><div class="line">...         return &apos;no&apos;</div><div class="line">...</div></pre></td></tr></table></figure>
<p>使用<code>cond.__code__</code>可以看到其字节码,但是看上去难以理解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; cond.__code__.co_code  # the bytecode as raw bytes</div><div class="line">b&apos;d\x01\x00&#125;\x00\x00|\x00\x00d\x02\x00k\x00\x00r\x16\x00d\x03\x00Sd\x04\x00Sd\x00</div><div class="line">   \x00S&apos;</div><div class="line">&gt;&gt;&gt; list(cond.__code__.co_code)  # the bytecode as numbers</div><div class="line">[100, 1, 0, 125, 0, 0, 124, 0, 0, 100, 2, 0, 107, 0, 0, 114, 22, 0, 100, 3, 0, 83,</div><div class="line"> 100, 4, 0, 83, 100, 0, 0, 83]</div></pre></td></tr></table></figure>
<p>使用标准库中的<code>dis</code> module来解决这个问题.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; dis.dis(cond)</div><div class="line">  2           0 LOAD_CONST               1 (3)</div><div class="line">              3 STORE_FAST               0 (x)</div><div class="line"></div><div class="line">  3           6 LOAD_FAST                0 (x)</div><div class="line">              9 LOAD_CONST               2 (5)</div><div class="line">             12 COMPARE_OP               0 (&lt;)</div><div class="line">             15 POP_JUMP_IF_FALSE       22</div><div class="line"></div><div class="line">  4          18 LOAD_CONST               3 (&apos;yes&apos;)</div><div class="line">             21 RETURN_VALUE</div><div class="line"></div><div class="line">  6     &gt;&gt;   22 LOAD_CONST               4 (&apos;no&apos;)</div><div class="line">             25 RETURN_VALUE</div><div class="line">             26 LOAD_CONST               0 (None)</div><div class="line">             29 RETURN_VALUE</div></pre></td></tr></table></figure>
<p>第一列的数字标示对应的源码行数<br>第二列数字是字节码的索引<br>第三列是指令本省对应的名字<br>第四列标示之列那个 参数<br>第五列标示关于参数的提示</p>
<h2 id="Conditrionals-and-Loops"><a href="#Conditrionals-and-Loops" class="headerlink" title="Conditrionals and Loops"></a>Conditrionals and Loops</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; def loop():</div><div class="line">...      x = 1</div><div class="line">...      while x &lt; 5:</div><div class="line">...          x = x + 1</div><div class="line">...      return x</div><div class="line">...</div><div class="line">&gt;&gt;&gt; dis.dis(loop)</div><div class="line">  2           0 LOAD_CONST               1 (1)</div><div class="line">              3 STORE_FAST               0 (x)</div><div class="line"></div><div class="line">  3           6 SETUP_LOOP              26 (to 35)</div><div class="line">        &gt;&gt;    9 LOAD_FAST                0 (x)</div><div class="line">             12 LOAD_CONST               2 (5)</div><div class="line">             15 COMPARE_OP               0 (&lt;)</div><div class="line">             18 POP_JUMP_IF_FALSE       34</div><div class="line"></div><div class="line">  4          21 LOAD_FAST                0 (x)</div><div class="line">             24 LOAD_CONST               1 (1)</div><div class="line">             27 BINARY_ADD</div><div class="line">             28 STORE_FAST               0 (x)</div><div class="line">             31 JUMP_ABSOLUTE            9</div><div class="line">        &gt;&gt;   34 POP_BLOCK</div><div class="line"></div><div class="line">  5     &gt;&gt;   35 LOAD_FAST                0 (x)</div><div class="line">             38 RETURN_VALUE</div></pre></td></tr></table></figure>
<h2 id="Explore-Bytecode"><a href="#Explore-Bytecode" class="headerlink" title="Explore Bytecode"></a>Explore Bytecode</h2><p>我鼓励你用dis.dis来试试你自己写的函数。一些有趣的问题值得探索：</p>
<ul>
<li>对解释器而言for循环和while循环有什么不同？</li>
<li>能不能写出两个不同函数，却能产生相同的字节码?</li>
<li>elif是怎么工作的？列表推导呢？</li>
</ul>
<h2 id="Frames"><a href="#Frames" class="headerlink" title="Frames"></a>Frames</h2><p>一个frame是一些信息的集合和代码的执行上下文。frames在Python代码执行时动态的创建和销毁。每个frame对应函数的一次调用。— 所以每个frame只有一个code object与之关联，而一个code object可以很多frame。比如你有一个函数递归的调用自己10次，这时有11个frame。总的来说，Python程序的每个作用域有一个frame，比如，每个module，每个函数调用，每个类定义。</p>
<p>ex:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; def bar(y):</div><div class="line">...     z = y + 3     # &lt;--- (3) ... and the interpreter is here.</div><div class="line">...     return z</div><div class="line">...</div><div class="line">&gt;&gt;&gt; def foo():</div><div class="line">...     a = 1</div><div class="line">...     b = 2</div><div class="line">...     return a + bar(b) # &lt;--- (2) ... which is returning a call to bar ...</div><div class="line">...</div><div class="line">&gt;&gt;&gt; foo()             # &lt;--- (1) We&apos;re in the middle of a call to foo ...</div></pre></td></tr></table></figure>
<p><img src="http://7xrn62.com1.z0.glb.clouddn.com/fe2d2dacab4fd28e6d6cd4acdf1f5ff2.png" alt="python frame 概念"></p>
<p>在，解释器在foo函数的调用中。调用栈中有3个fram：一个对应于module层，一个对应函数foo,别一个对应函数bar。(Figure 1.2)一旦bar返回，与它对应的frame就会从调用栈中弹出并丢弃。</p>
<p>我惊讶的发现Python真的很少依赖于每个frame有一个数据栈这个特性。在Python中几乎所有的操作都会清空数据栈，所以所有的frame公用一个数据栈是没问题的。在上面的例子中，当bar执行完后，它的数据栈为空。即使foo公用这一个栈，它的值也不会受影响。然而，对应生成器，一个关键的特点是它能暂停一个frame的执行，返回到其他的frame，一段时间后它能返回到原来的frame，并以它离开时的同样的状态继续执行。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/04/27/HTTP/2016_04_27_oauth授权认证/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/27/HTTP/2016_04_27_oauth授权认证/" itemprop="url">OAuth授权认证</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-27T15:55:00+08:00">
                2016-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index">
                    <span itemprop="name">Misc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/04/27/HTTP/2016_04_27_oauth授权认证/" class="leancloud_visitors" data-flag-title="OAuth授权认证">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/04/21/MISC/2016_04_21_mysql出现lock-wait-timeout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/21/MISC/2016_04_21_mysql出现lock-wait-timeout/" itemprop="url">mysql出现Lock-Wait-Timeout</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-21T17:17:00+08:00">
                2016-04-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index">
                    <span itemprop="name">Misc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/04/21/MISC/2016_04_21_mysql出现lock-wait-timeout/" class="leancloud_visitors" data-flag-title="mysql出现Lock-Wait-Timeout">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="mysql出现Lock-Wait-Timeout"><a href="#mysql出现Lock-Wait-Timeout" class="headerlink" title="mysql出现Lock Wait Timeout"></a>mysql出现Lock Wait Timeout</h1><p>使用的RDS,出现了Lock Wait Timeout的问题<br>解决方法</p>
<p>以ROOT用户登录数据库后执行<br><code>SHOW FULL PROCESSLIST</code>,然后<code>KILL &lt;id&gt;</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/04/20/SQL/2016_04_20_mysql的时间查询操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/20/SQL/2016_04_20_mysql的时间查询操作/" itemprop="url">mysql的时间查询操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-20T13:24:00+08:00">
                2016-04-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index">
                    <span itemprop="name">Misc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/04/20/SQL/2016_04_20_mysql的时间查询操作/" class="leancloud_visitors" data-flag-title="mysql的时间查询操作">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL关于时间的查询"><a href="#MySQL关于时间的查询" class="headerlink" title="MySQL关于时间的查询"></a>MySQL关于时间的查询</h1><ul>
<li><p>1 、 查看当天日期</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select current_date();</div></pre></td></tr></table></figure>
</li>
<li><p>2、 查看当天时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select current_time();</div></pre></td></tr></table></figure>
</li>
<li><p>3、查看当天时间日期</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select current_timestamp();</div></pre></td></tr></table></figure>
</li>
<li><p>4、查询当天记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from 表名 where to_days(时间字段名) = to_days(now());</div></pre></td></tr></table></figure>
</li>
<li><p>5、查询昨天记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM 表名 WHERE TO_DAYS( NOW( ) ) – TO_DAYS( 时间字段名) &lt;= 1</div></pre></td></tr></table></figure>
</li>
<li><p>6、查询7天的记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM 表名 where DATE_SUB(CURDATE(), INTERVAL 7 DAY) &lt;= date(时间字段名)</div></pre></td></tr></table></figure>
</li>
<li><p>7、查询近30天的记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM 表名 where DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= date(时间字段名)</div></pre></td></tr></table></figure>
</li>
<li><p>8、查询本月的记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM 表名 WHERE DATE_FORMAT( 时间字段名, ‘%Y%m’ ) = DATE_FORMAT( CURDATE( ) , ‘%Y%m’ )</div></pre></td></tr></table></figure>
</li>
<li><p>9、查询上一月的记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM 表名 WHERE PERIOD_DIFF( date_format( now( ) , ‘%Y%m’ ) , date_format( 时间字段名, ‘%Y%m’ ) ) =1</div></pre></td></tr></table></figure>
</li>
<li><p>10、查询本季度数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from 表名 where QUARTER(create_date)=QUARTER(now());</div></pre></td></tr></table></figure>
</li>
<li><p>11、查询上季度数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from 表名 where QUARTER(create_date)=QUARTER(DATE_SUB(now(),interval 1 QUARTER));</div></pre></td></tr></table></figure>
</li>
<li><p>12、查询本年数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from 表名  where YEAR(create_date)=YEAR(NOW());</div></pre></td></tr></table></figure>
</li>
<li><p>13、查询上年数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from 表名 where year(create_date)=year(date_sub(now(),interval 1 year));</div></pre></td></tr></table></figure>
</li>
<li><p>14、查询当前这周的数据</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM 表名 WHERE YEARWEEK(date_format(submittime,&apos;%Y-%m-%d&apos;)) = YEARWEEK(now());</div></pre></td></tr></table></figure>
<ul>
<li>15、查询上周的数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SELECT * FROM 表名 WHERE YEARWEEK(date_format(submittime,&apos;%Y-%m-%d&apos;)) = YEARWEEK(now())-1;</div></pre></td></tr></table></figure>
<ul>
<li><p>16、查询当前月份的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select * from 表名   where date_format(submittime,&apos;%Y-%m&apos;)=date_format(now(),&apos;%Y-%m&apos;)</div></pre></td></tr></table></figure>
</li>
<li><p>17、查询距离当前现在6个月的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select name,submittime from enterprise where submittime between date_sub(now(),interval 6 month) and now();</div></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/04/19/python/2016_04_19_python打包和发布/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/19/python/2016_04_19_python打包和发布/" itemprop="url">python打包和发布</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-19T14:58:00+08:00">
                2016-04-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/04/19/python/2016_04_19_python打包和发布/" class="leancloud_visitors" data-flag-title="python打包和发布">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="setuptools工具"><a href="#setuptools工具" class="headerlink" title="setuptools工具"></a>setuptools工具</h1><h2 id="编写setupt-py文件"><a href="#编写setupt-py文件" class="headerlink" title="编写setupt.py文件"></a>编写<code>setupt.py</code>文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">from setuptools import setup</div><div class="line">setup(name=&quot;pyIP&quot;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">python setup.py --help-commands</div><div class="line">Standard commands:</div><div class="line">  build             build everything needed to install</div><div class="line">  build_py          &quot;build&quot; pure Python modules (copy to build directory)</div><div class="line">  build_ext         build C/C++ extensions (compile/link to build directory)</div><div class="line">  build_clib        build C/C++ libraries used by Python extensions</div><div class="line">  build_scripts     &quot;build&quot; scripts (copy and fixup #! line)</div><div class="line">  clean             clean up temporary files from &apos;build&apos; command</div><div class="line">  install           install everything from build directory</div><div class="line">  install_lib       install all Python modules (extensions and pure Python)</div><div class="line">  install_headers   install C/C++ header files</div><div class="line">  install_scripts   install scripts (Python or otherwise)</div><div class="line">  install_data      install data files</div><div class="line">  sdist             create a source distribution (tarball, zip file, etc.)</div><div class="line">  register          register the distribution with the Python package index</div><div class="line">  bdist             create a built (binary) distribution</div><div class="line">  bdist_dumb        create a &quot;dumb&quot; built distribution</div><div class="line">  bdist_rpm         create an RPM distribution</div><div class="line">  bdist_wininst     create an executable installer for MS Windows</div><div class="line">  upload            upload binary package to PyPI</div><div class="line">  check             perform some checks on the package</div><div class="line"></div><div class="line">Extra commands:</div><div class="line">  develop           install package in &apos;development mode&apos;</div><div class="line">  saveopts          save supplied options to setup.cfg or other config file</div><div class="line">  egg_info          create a distribution&apos;s .egg-info directory</div><div class="line">  upload_docs       Upload documentation to PyPI</div><div class="line">  alias             define a shortcut to invoke one or more commands</div><div class="line">  easy_install      Find/get/install Python packages</div><div class="line">  rotate            delete older distributions, keeping N newest files</div><div class="line">  bdist_egg         create an &quot;egg&quot; distribution</div><div class="line">  install_egg_info  Install an .egg-info directory for the package</div><div class="line">  test              run unit tests after in-place build</div><div class="line">  setopt            set an option in setup.cfg or another config file</div></pre></td></tr></table></figure>
<h2 id="sdist–创建一个发行树"><a href="#sdist–创建一个发行树" class="headerlink" title="sdist–创建一个发行树"></a><code>sdist</code>–创建一个发行树</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python setup.py sdist</div></pre></td></tr></table></figure>
<p>如果需要执行脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scripts=[&apos;bin/sshtool.py&apos;]</div></pre></td></tr></table></figure></p>
<h2 id="register和upload命令"><a href="#register和upload命令" class="headerlink" title="register和upload命令"></a><code>register</code>和<code>upload</code>命令</h2><p>pypi服务器,位于<a href="http://pypi.python.org/pypi.这是distutils包所使用的默认服务器" target="_blank" rel="external">http://pypi.python.org/pypi.这是distutils包所使用的默认服务器</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">python setup.py register</div><div class="line">python setup.py sdist upload</div><div class="line">python setup.py sdist upload -r pypi-server //可以选择服务器</div></pre></td></tr></table></figure>
<p>会在主目录下存在一个<code>.pypirc</code>的文件保存帐号和密码.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/04/14/python/2016_04_14_python和mongodb--using-mongoengine/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/14/python/2016_04_14_python和mongodb--using-mongoengine/" itemprop="url">python和MongoDB--Using MongoEngine</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-14T16:06:00+08:00">
                2016-04-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/04/14/python/2016_04_14_python和mongodb--using-mongoengine/" class="leancloud_visitors" data-flag-title="python和MongoDB--Using MongoEngine">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Python操作MongoDB–使用MongoEngine"><a href="#Python操作MongoDB–使用MongoEngine" class="headerlink" title="Python操作MongoDB–使用MongoEngine"></a>Python操作MongoDB–使用MongoEngine</h1><p>python操作mongo的模块用很多,如果你习惯与ORM,那么推荐使用MongoEngine.</p>
<h2 id="RefernceField"><a href="#RefernceField" class="headerlink" title="RefernceField"></a>RefernceField</h2><p>可以很方便的构建一对多或多对多的关系</p>
<h2 id="oreder-by"><a href="#oreder-by" class="headerlink" title="oreder_by"></a>oreder_by</h2><h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/04/09/python/2016_04_09_window下折腾python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/09/python/2016_04_09_window下折腾python/" itemprop="url">Window折腾Python</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-09T18:41:00+08:00">
                2016-04-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/04/09/python/2016_04_09_window下折腾python/" class="leancloud_visitors" data-flag-title="Window折腾Python">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Windows下折腾python"><a href="#Windows下折腾python" class="headerlink" title="Windows下折腾python"></a>Windows下折腾python</h1><h2 id="Unable-to-find-vcvarsall-bat"><a href="#Unable-to-find-vcvarsall-bat" class="headerlink" title="Unable to find vcvarsall.bat"></a>Unable to find vcvarsall.bat</h2><p>命令行下执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SET VS90COMNTOOLS=%VS100COMNTOOLS%</div></pre></td></tr></table></figure></p>
<p>如果你安装的是 2012 版<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SET VS90COMNTOOLS=%VS110COMNTOOLS%</div></pre></td></tr></table></figure></p>
<p>如果你安装的是 2013版<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SET VS90COMNTOOLS=%VS120COMNTOOLS%</div></pre></td></tr></table></figure></p>
<p>或者更暴力，直接配置系统环境变量 VS90COMNTOOLS指向 %VS你的版本COMNTOOLS%</p>
<p>你还可以更暴力，在<code>..python安装路径...\Lib\distutils目录下有个msvc9compiler.py</code>找到243行  </p>
<p><code>toolskey = &quot;VS%0.f0COMNTOOLS&quot; % version</code>   直接改为 <code>toolskey = &quot;VS你的版本COMNTOOLS&quot;(这个就是为什么要配 ”VS90COMNTOOLS“ 的原因，因为人家文件名都告诉你了是  Microsoft vc 9的compiler,   代码都写死了要vc9的comntools，就要找这个玩意儿，找不到不干活)</code></p>
<p>这么做的理由是<code>Python2.7</code> 扩展包是可以用08版或者更高的VS编译的，其<code>setup.py</code>(安装脚本)都是去windows系统寻找08版的VS,所以设置VS90的path</p>
<p>如果Python版本小于2.7，强烈建议使用 VS08版，用2010或者更高可能部分扩展不好使。给个例子：</p>
<p>在安装一些Python模块时，大部分是cpython写的模块时会发生如下错误 <code>error: Unable to find vcvarsall.bat</code>先前的一篇文章：在Windows上安装Scrapy时也讲到了这个问题。当时讲到的方案是，安装VS 2008进行解决，但是Vs 2008又太大，不想装，所以这次想到了另外的方案，同样是上次说的，当时上次很不完整。<br>解决方案一：安装Vs2008（实测）<br>完全的无脑流，安装完问题直接解决。<br>解决方案二：安装Vs2010（未测试）<br>上次在电脑上装个Vs2010并不能像 vs2008那样直接解决问题，从网上找到如下解决方案，不知是否可行。<br>打开<code>&lt;python安装目录&gt;\Lib\distutils\msvc9compiler.py</code><br>找到 <code>toolskey = &quot;VS%0.f0COMNTOOLS&quot; % version</code>，直接修改为 <code>toolskey = &quot;VS100COMNTOOLS&quot;</code><br>解决方案三：安装MinGW（实测）</p>
<h3 id="1、下载安装MinGW，下载地址为：MinGW"><a href="#1、下载安装MinGW，下载地址为：MinGW" class="headerlink" title="1、下载安装MinGW，下载地址为：MinGW"></a>1、下载安装MinGW，下载地址为：<a href="http://sourceforge.net/projects/mingw/files/latest/download?source=files" target="_blank" rel="external">MinGW</a></h3><h3 id="2、在MinGW的安装目录下找到bin文件夹，找到mingw32-make-exe，复制一份更名为make-exe"><a href="#2、在MinGW的安装目录下找到bin文件夹，找到mingw32-make-exe，复制一份更名为make-exe" class="headerlink" title="2、在MinGW的安装目录下找到bin文件夹，找到mingw32-make.exe，复制一份更名为make.exe"></a>2、在<code>MinGW</code>的安装目录下找到<code>bin</code>文件夹，找到<code>mingw32-make.exe</code>，复制一份更名为<code>make.exe</code></h3><h3 id="3、把MinGW的路径添加到环境变量path中，比如我把MinGW安装到D-MinGW-中，就把D-MinGW-bin添加到path中；"><a href="#3、把MinGW的路径添加到环境变量path中，比如我把MinGW安装到D-MinGW-中，就把D-MinGW-bin添加到path中；" class="headerlink" title="3、把MinGW的路径添加到环境变量path中，比如我把MinGW安装到D:\MinGW\中，就把D:\MinGW\bin添加到path中；"></a>3、把<code>MinGW</code>的路径添加到环境变量<code>path</code>中，比如我把M<code>inGW</code>安装到<code>D:\MinGW\</code>中，就把<code>D:\MinGW\bin</code>添加到<code>path</code>中；</h3><h3 id="4、在-lt-python安装目录-gt-distutils增加文件distutils-cfg，在文件里输入"><a href="#4、在-lt-python安装目录-gt-distutils增加文件distutils-cfg，在文件里输入" class="headerlink" title="4、在&lt;python安装目录&gt;\distutils增加文件distutils.cfg，在文件里输入"></a>4、在<code>&lt;python安装目录&gt;\distutils</code>增加文件<code>distutils.cfg</code>，在文件里输入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[build]</div><div class="line">compiler=mingw32</div></pre></td></tr></table></figure>
<p>保存；</p>
<h3 id="5、执行原先的模块安装，发现还是报错，报错内容为"><a href="#5、执行原先的模块安装，发现还是报错，报错内容为" class="headerlink" title="5、执行原先的模块安装，发现还是报错，报错内容为"></a>5、执行原先的模块安装，发现还是报错，报错内容为</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">：error: command ‘gcc’ failed: No such file or directory</div></pre></td></tr></table></figure>
<p>解决方案是将<code>D:\MinGW\lib</code>再添加到PATH中。</p>
<h3 id="6、如果安装过程中出现-error-Could-not-find-‘openssl-exe’-则直接到http-pypi-python-org-pypi-pyOpenSSL-0-13-下载安装即可。"><a href="#6、如果安装过程中出现-error-Could-not-find-‘openssl-exe’-则直接到http-pypi-python-org-pypi-pyOpenSSL-0-13-下载安装即可。" class="headerlink" title="6、如果安装过程中出现 error: Could not find ‘openssl.exe’ 则直接到http://pypi.python.org/pypi/pyOpenSSL/0.13 下载安装即可。"></a>6、如果安装过程中出现 error: Could not find ‘openssl.exe’ 则直接到<a href="http://pypi.python.org/pypi/pyOpenSSL/0.13" target="_blank" rel="external">http://pypi.python.org/pypi/pyOpenSSL/0.13</a> 下载安装即可。</h3><h3 id="7、再次执行时安装模块时，发现如下错误："><a href="#7、再次执行时安装模块时，发现如下错误：" class="headerlink" title="7、再次执行时安装模块时，发现如下错误："></a>7、再次执行时安装模块时，发现如下错误：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">D:\MinGW\bin\gcc.exe -mno-cygwin -mdll -O -Wall “-ID:\Program Files\Python27\inc</div><div class="line">lude” “-ID:\Program Files\Python27\include” “-ID:\Program Files\Python27\PC” -c</div><div class="line">../libdasm.c -o build\temp.win32-2.7\Release\..\libdasm.o</div><div class="line">cc1.exe: error:unrecognized command line option ‘-mno-cygwin’</div><div class="line">error: command ‘gcc’ failed with exit status 1</div></pre></td></tr></table></figure>
<p>原因是<code>gcc 4.6.x</code> 以后不再接受<code>-mno-cygwin</code>为了解决这个问题需要修改<code>&lt;python安装目录&gt;\distutils\cygwinccompiler.py</code>文件。找到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">self.set_executables(compiler=&amp;#039;gcc -mno-cygwin -O -Wall&amp;#039;,</div><div class="line">                            compiler_so=&amp;#039;gcc -mno-cygwin -mdll -O -Wall&amp;#039;,</div><div class="line">                            compiler_cxx=&amp;#039;g++ -mno-cygwin -O -Wall&amp;#039;,</div><div class="line">                            linker_exe=&amp;#039;gcc&amp;#039;,</div><div class="line">                            linker_so=&amp;#039;%s -mno-cygwin %s %s&amp;#039;</div><div class="line">                                       % (self.linker_dll, shared_option,</div><div class="line">                                          entry_point))</div></pre></td></tr></table></figure>
<p>   修改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">self.set_executables(compiler=&amp;#039;gcc -O -Wall&amp;#039;,</div><div class="line">                            compiler_so=&amp;#039;gcc -mdll -O -Wall&amp;#039;,</div><div class="line">                            compiler_cxx=&amp;#039;g++ -mno-cygwin -O -Wall&amp;#039;,</div><div class="line">                            linker_exe=&amp;#039;gcc&amp;#039;,</div><div class="line">                            linker_so=&amp;#039;%s -mno-cygwin %s %s&amp;#039;</div><div class="line">                                       % (self.linker_dll, shared_option,</div><div class="line">                                          entry_point))</div></pre></td></tr></table></figure>
<p>   an</p>
<h2 id="No-module-named-Crypto-PublicKey"><a href="#No-module-named-Crypto-PublicKey" class="headerlink" title="No module named Crypto.PublicKey"></a>No module named Crypto.PublicKey</h2><p>明明安装了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install pycrypto</div></pre></td></tr></table></figure></p>
<p>解决方法：<br>We should rename crypto directory under “Lib/site-packages” to Crypto<br>因为windows是不区分大小写的，但是py加载模块区分。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/04/05/HTTP/2016_04_05_raml初识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/04/05/HTTP/2016_04_05_raml初识/" itemprop="url">RAML初识</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-05T18:20:00+08:00">
                2016-04-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index">
                    <span itemprop="name">Misc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/04/05/HTTP/2016_04_05_raml初识/" class="leancloud_visitors" data-flag-title="RAML初识">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="RAML"><a href="#RAML" class="headerlink" title="RAML"></a>RAML</h1><p>raml()<br><a href="https://www.mulesoft.com/platform/api/api-designer" target="_blank" rel="external">在线的API designer tool</a></p>
<h2 id="ENTER-THE-ROOT"><a href="#ENTER-THE-ROOT" class="headerlink" title="ENTER THE ROOT"></a>ENTER THE ROOT</h2><p>确定根的url<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#%RAML 1.0</div><div class="line">  ---</div><div class="line">  title: e-BookMobile API</div><div class="line">  baseUri: http://api.e-bookmobile.com/&#123;version&#125;</div><div class="line">  version: v1</div></pre></td></tr></table></figure></p>
<h2 id="ENTER-RESOURCES"><a href="#ENTER-RESOURCES" class="headerlink" title="ENTER RESOURCES"></a>ENTER RESOURCES</h2><p>确定资源，资源一般都是一个名词<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/users:</div><div class="line">    /authors:</div><div class="line">    /books:</div></pre></td></tr></table></figure></p>
<h2 id="ENTER-METHODS"><a href="#ENTER-METHODS" class="headerlink" title="ENTER METHODS"></a>ENTER METHODS</h2><p>确定方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">/books:</div><div class="line">      get:</div><div class="line">      post:</div><div class="line">      put:</div></pre></td></tr></table></figure></p>
<h2 id="ENTER-URI-PARAMETERS"><a href="#ENTER-URI-PARAMETERS" class="headerlink" title="ENTER URI PARAMETERS"></a>ENTER URI PARAMETERS</h2><p>确定URI的参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/books:</div><div class="line">    get:</div><div class="line">    put:</div><div class="line">    post:</div><div class="line">    /&#123;bookTitle&#125;:</div><div class="line">      get:</div><div class="line">      put:</div><div class="line">      delete:</div><div class="line">      /author:</div><div class="line">        get:</div><div class="line">      /publisher:</div><div class="line">        get:</div></pre></td></tr></table></figure></p>
<h2 id="确定查询的参数"><a href="#确定查询的参数" class="headerlink" title="确定查询的参数"></a>确定查询的参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">/books:</div><div class="line">     /&#123;bookTitle&#125;</div><div class="line">       get:</div><div class="line">         queryParameters:</div><div class="line">           author:</div><div class="line">           publicationYear:</div><div class="line">           rating:</div><div class="line">           isbn:</div><div class="line">       put:</div><div class="line">         queryParameters:</div><div class="line">           access_token:</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">/books:</div><div class="line">     /&#123;bookTitle&#125;</div><div class="line">       get:</div><div class="line">         queryParameters:</div><div class="line">           author:</div><div class="line">             displayName: Author</div><div class="line">             type: string</div><div class="line">             description: An author&apos;s full name</div><div class="line">             example: Mary Roach</div><div class="line">             required: false</div><div class="line">           publicationYear:</div><div class="line">             displayName: Pub Year</div><div class="line">             type: number</div><div class="line">             description: The year released for the first time in the US</div><div class="line">             example: 1984</div><div class="line">             required: false</div><div class="line">           rating:</div><div class="line">             displayName: Rating</div><div class="line">             type: number</div><div class="line">             description: Average rating (1-5) submitted by users</div><div class="line">             example: 3.14</div><div class="line">             required: false</div><div class="line">           isbn:</div><div class="line">             displayName: ISBN</div><div class="line">             type: string</div><div class="line">             minLength: 10</div><div class="line">             example: 0321736079?</div><div class="line">        put:</div><div class="line">          queryParameters:</div><div class="line">            access_token:</div><div class="line">              displayName: Access Token</div><div class="line">              type: string</div><div class="line">              description: Token giving you permission to make call</div><div class="line">              required: true</div></pre></td></tr></table></figure>
<h2 id="ENTER-RESPONSES"><a href="#ENTER-RESPONSES" class="headerlink" title="ENTER RESPONSES"></a>ENTER RESPONSES</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/books:</div><div class="line">     /&#123;bookTitle&#125;:</div><div class="line">       get:</div><div class="line">         description: Retrieve a specific book title</div><div class="line">         responses:</div><div class="line">           200:</div><div class="line">             body:</div><div class="line">               application/json:</div><div class="line">                example: |</div><div class="line">                   &#123;</div><div class="line">                     &quot;data&quot;: &#123;</div><div class="line">                       &quot;id&quot;: &quot;SbBGk&quot;,</div><div class="line">                       &quot;title&quot;: &quot;Stiff: The Curious Lives of Human Cadavers&quot;,</div><div class="line">                       &quot;description&quot;: null,</div><div class="line">                       &quot;datetime&quot;: 1341533193,</div><div class="line">                       &quot;genre&quot;: &quot;science&quot;,</div><div class="line">                       &quot;author&quot;: &quot;Mary Roach&quot;,</div><div class="line">                       &quot;link&quot;: &quot;http://e-bookmobile.com/books/Stiff&quot;,</div><div class="line">                     &#125;,</div><div class="line">                     &quot;success&quot;: true,</div><div class="line">                     &quot;status&quot;: 200</div><div class="line">                   &#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/03/30/python/2016_03_30_python面向对象--描述符和属性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/30/python/2016_03_30_python面向对象--描述符和属性/" itemprop="url">python面向对象--描述符和属性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-30T17:27:00+08:00">
                2016-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/03/30/python/2016_03_30_python面向对象--描述符和属性/" class="leancloud_visitors" data-flag-title="python面向对象--描述符和属性">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python面向对象–描述符和属性"><a href="#python面向对象–描述符和属性" class="headerlink" title="python面向对象–描述符和属性"></a>python面向对象–描述符和属性</h1><h2 id="python中的私有属性"><a href="#python中的私有属性" class="headerlink" title="python中的私有属性"></a>python中的私有属性</h2><p>python中没有访问限制的描速符.通过<code>__</code>符号来实现</p>
<p>Ex:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">class MyClass(object):</div><div class="line">    __secret_value = 1</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">In [3]: m.__secret_value</div><div class="line">---------------------------------------------------------------------------</div><div class="line">AttributeError                            Traceback (most recent call last)</div><div class="line">&lt;ipython-input-3-3a26128381d5&gt; in &lt;module&gt;()</div><div class="line">----&gt; 1 m.__secret_value</div><div class="line"></div><div class="line">AttributeError: &apos;MyClass&apos; object has no attribute &apos;__secret_value&apos;</div></pre></td></tr></table></figure>
<p>查看属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">In [4]: dir(m)</div><div class="line">Out[4]:</div><div class="line">[&apos;_MyClass__secret_value&apos;,</div><div class="line"> &apos;__class__&apos;,</div></pre></td></tr></table></figure></p>
<p>其实也并不是真正意义上的私有属性.</p>
<h2 id="描述符"><a href="#描述符" class="headerlink" title="描述符"></a>描述符</h2><p>描述符用来自定义在引用一个对象上的特性时所应该完成的事情.<br>基于如下三个特殊的方法</p>
<ul>
<li><code>__set__</code> 在任何属性被设置时调用,setter;</li>
<li><code>__get__</code> 在任何属性被读取的时候被调用,getter;</li>
<li><code>__delete__</code><br>这些方法都在 <code>__dict__</code>之前被调用.</li>
</ul>
<p>其实就是通过一个类,对另外一个类的某个属性进行控制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">class UpperString(object):</div><div class="line">	def __init__(self):</div><div class="line">		self._val = &quot;&quot;</div><div class="line">	def __get__(self, instance, klass):</div><div class="line">		return self._val</div><div class="line">	def __set__(self, instance, value):</div><div class="line">		self._val = value.upper()</div><div class="line"></div><div class="line">class MyClass(object):</div><div class="line">	attribute = UpperString()</div><div class="line"></div><div class="line">mc = MyClass()</div><div class="line">mc.attribute = &quot;my value&quot;</div><div class="line">print mc.attribute</div></pre></td></tr></table></figure>
<h2 id="自省描述符"><a href="#自省描述符" class="headerlink" title="自省描述符"></a>自省描述符</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">API</span><span class="params">(object)</span>:</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_print_values</span><span class="params">(self, obj)</span>:</span></div><div class="line">		<span class="function"><span class="keyword">def</span> <span class="title">_print_value</span><span class="params">(key)</span>:</span></div><div class="line">			<span class="keyword">if</span> key.startswith(<span class="string">'_'</span>):</div><div class="line">				<span class="keyword">return</span> <span class="string">''</span></div><div class="line">			value = getattr(obj, key)</div><div class="line">			<span class="keyword">if</span> <span class="keyword">not</span> hasattr(value, <span class="string">'im_func'</span>):</div><div class="line">				doc = type(value).__name__</div><div class="line">			<span class="keyword">else</span>:</div><div class="line">				<span class="keyword">if</span> value.__doc__ <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">					doc = <span class="string">'no docstring'</span></div><div class="line">				<span class="keyword">else</span>:</div><div class="line">					doc = value.__doc__</div><div class="line">			<span class="keyword">return</span> <span class="string">" %s : %s"</span> % (key, value)</div><div class="line">		res = [_print_value(el) <span class="keyword">for</span> el <span class="keyword">in</span> dir(obj)]</div><div class="line">		<span class="keyword">return</span> <span class="string">'\n'</span>.join([el <span class="keyword">for</span> el <span class="keyword">in</span> res <span class="keyword">if</span> el != <span class="string">""</span>])</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, klass)</span>:</span></div><div class="line">		<span class="keyword">if</span> instance <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</div><div class="line">			<span class="keyword">return</span> self._print_values(instance)</div><div class="line">		<span class="keyword">else</span>:</div><div class="line">			<span class="keyword">return</span> self._print_values(klass)</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></div><div class="line">	__doc__ = API()</div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div><div class="line">		self.a = <span class="number">2</span></div><div class="line">	<span class="function"><span class="keyword">def</span> <span class="title">meth</span><span class="params">(self)</span>:</span></div><div class="line">		<span class="string">'''</span></div><div class="line">		my method</div><div class="line">		'''</div><div class="line">		<span class="keyword">return</span> <span class="number">1</span></div><div class="line"><span class="keyword">print</span> MyClass.__doc__</div><div class="line">instance = MyClass()</div><div class="line"><span class="keyword">print</span> <span class="string">"========"</span></div><div class="line"><span class="keyword">print</span> instance.__doc__</div></pre></td></tr></table></figure>
<p>output:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">meth : &lt;unbound method MyClass.meth&gt;</div><div class="line">========</div><div class="line">a : 2</div><div class="line">meth : &lt;bound method MyClass.meth of &lt;__main__.MyClass object at 0x7fe3295bcad0&gt;&gt;</div></pre></td></tr></table></figure>
<h2 id="元描述符"><a href="#元描述符" class="headerlink" title="元描述符"></a>元描述符</h2><h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>属性提供了一个内建的描述符类型,属性采用<code>fget</code>和3个可选的参数–<code>fset</code>, <code>fdel</code>和<code>doc</code></p>
<h2 id="槽"><a href="#槽" class="headerlink" title="槽"></a>槽</h2><p>这个概念很少遇到</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://fsxchen.github.io/2016/03/28/python/2016_03_28_with和contextlib/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="arron">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/img/ar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CouCou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/28/python/2016_03_28_with和contextlib/" itemprop="url">with和contextlib</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-28T11:12:00+08:00">
                2016-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2016/03/28/python/2016_03_28_with和contextlib/" class="leancloud_visitors" data-flag-title="with和contextlib">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="with和contgextlib"><a href="#with和contgextlib" class="headerlink" title="with和contgextlib"></a>with和contgextlib</h1><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><p>即使运行失败也要退出,比如:</p>
<ul>
<li>关闭一个文件</li>
<li>释放一个锁</li>
<li>创建一个临时的代码补丁</li>
<li>在特殊环境中运行受保护的代码</li>
</ul>
<h2 id="with语句和上下文协议"><a href="#with语句和上下文协议" class="headerlink" title="with语句和上下文协议"></a>with语句和上下文协议</h2><p>最常用的是打开和关闭一个文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">from __future__ import with_statement</div><div class="line"># 在2.5 以及2.5之前,需要这样引入</div><div class="line">with open(&apos;/etc/hosts&apos;) as fd:</div><div class="line">    for line in fd</div></pre></td></tr></table></figure>
<p>实现with的协议如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">class Context(object):</div><div class="line">	def __enter__(self):</div><div class="line">		print(&quot;entering the zone&quot;)</div><div class="line">	def __exit__(self, exception_type, exception_value,</div><div class="line">					exception_traceback):</div><div class="line">		print(&apos;leaving the zone&apos;)</div><div class="line">		if exception_type is None:</div><div class="line">			print(&apos;no error&apos;)</div><div class="line">		else:</div><div class="line">			print(&quot;with an error (%s)&quot; % exception_value)</div><div class="line"></div><div class="line">with Context():</div><div class="line">	print(&quot;i an the zone&quot;)</div></pre></td></tr></table></figure>
<p>output<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">entering the zone</div><div class="line">i an the zone</div><div class="line">leaving the zone</div><div class="line">no error</div><div class="line">[Finished in 0.1s]</div></pre></td></tr></table></figure></p>
<p>在py中,一个类实现两个方法 <code>__enter__</code>和<code>__exit__</code>,就实现了with协议,<code>thread</code>和<code>threading</code>模块的一些类也实现了这些方法<br>thread.LockType<br>threading.Lock<br>threading.RLock<br>threading.Condition<br>threading.Semaphore<br>threading.BoundedSemaphore</p>
<h2 id="contextlib模块"><a href="#contextlib模块" class="headerlink" title="contextlib模块"></a>contextlib模块</h2><p>给with提供了一个辅助类,包含了一yield分开的<code>__enter__</code>和<code>__exit__</code>,所以上面的离职可以写成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">from contextlib import contextmanager</div><div class="line"># from __future__ import with_statement</div><div class="line"></div><div class="line">@contextmanager</div><div class="line">def context():</div><div class="line">	print(&quot;entering the zone&quot;)</div><div class="line">	try:</div><div class="line">		yield</div><div class="line">	except Exception, e:</div><div class="line">		print(&quot;with an error (%s) % e&quot;)</div><div class="line">		raise e</div><div class="line">	else:</div><div class="line">		print(&quot;with no error&quot;)</div><div class="line"></div><div class="line">with context():</div><div class="line">	print(&quot;starting&quot;)</div></pre></td></tr></table></figure></p>
<h2 id="上下文实例"><a href="#上下文实例" class="headerlink" title="上下文实例"></a>上下文实例</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/img/ar.gif"
               alt="arron" />
          <p class="site-author-name" itemprop="name">arron</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">55</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/fsxchen" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://markdown-stackedit.herokuapp.com" title="在线编辑器" target="_blank">在线编辑器</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="/api_tool" title="API工具" target="_blank">API工具</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">arron</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (search_path.endsWith("json")) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("m8jV8mMvHNonbLFFLyojmGAU-gzGzoHsz", "hPxoaT3pdfhuxmfdD14JpCcP");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
