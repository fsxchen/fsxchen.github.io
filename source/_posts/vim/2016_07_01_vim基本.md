---
title: vim基本
date: 2016-7-1 17:32
categories:
	- Misc
tags:
	- vim
---

# VIM

1 关于Vim

vim是我最喜欢的编辑器，也是linux下第二强大的编辑器。虽然emacs是公认的世界第一，我认为使用emacs并没有使用vi进行编辑来得高效。如果是初学vi，运行一下vimtutor是个聪明的决定。
2 启动Vim时的选项

    * vim -c cmd file: 在打开文件前，先执行指定的命令；
    * vim -r file: 恢复上次异常退出的文件；
    * vim -R file: 以只读的方式打开文件；
    * vim -y num file: 将编辑窗口的大小设为num行；
    * vim + file: 从文件的末尾开始；
    * vim +num file: 从第num行开始；

3 光标的移动

    * h: 左移一个字符；
    * l: 右移一个字符；
    * j: 下移一个字符；
    * k: 上移一个字符；
    * w: 前移一个单词，光标停在下一个单词开头；
    * e: 前移一个单词，光标停在下一个单词末尾；
    * b: 后移一个单词，光标停在上一个单词开头；
    * ge: 后移一个单词，光标停在上一个单词末尾；
    * fc: 把光标移到同一行的下一个c字符处

上面的操作都可以配合n使用，比如在正常模式(下面会讲到)下输入3h，则光标向左移动3个字符。

    * 0或^:移动到行首。
    * $: 移动到行尾。
    * gg: 到文件头部。
    * G: 到文件尾部。
    * nG: 到文件第n行。
    * :n<cr> 移动到第n行。
    * :$<cr> 移动到最后一行。
    * n|: 把光标移到递n列上。
    * +或Enter:把光标移至下一行第一个非空白字符。
    * -: 把光标移至上一行第一个非空白字符。
    * H: 把光标移到屏幕最顶端一行。
    * L: 把光标移到屏幕最底端一行。
    * ctrl+f: 下翻一屏。
    * ctrl+b: 上翻一屏。
    * ctrl+d: 下翻半屏。
    * ctrl+u: 上翻半屏。

4 Vim的几种模式

    * 正常模式：可以使用快捷键命令，或按:输入命令行。
    * 插入模式：可以输入文本，在正常模式下，按i、a、o等都可以进入插入模式。
    * 可视模式：正常模式下按v可以进入可视模式，在可视模式下，移动光标可以选择文本。
    * 块选择模式：正常模式下按ctrl+v进入。
    * 替换模式：正常模式下，按R进入。

5 插入

    * i: 在光标前插入；
    * I: 在当前行最前插入；
    * a: 在光标后插入；
    * A: 在当前行最后插入；
    * o: 在下面新建一行插入；
    * O: 在上面新建一行插入；
    * :r filename 在当前位置插入另一个文件的内容。
    * :r !date 在光标处插入当前日期与时间。同理，:r!command可以将其它shell命令的输出插入当前文档。

6 改写

    * c[n]w: 改写光标后1(n)个词。
    * c[n]l: 改写光标后n个字母。
    * c[n]h: 改写光标前n个字母。
    * [n]cc: 修改当前[n]行。
    * [n]s: 以输入的文本替代光标之后1(n)个字符，相当于c[n]l。
    * [n]S: 删除指定数目的行，并以所输入文本代替之。

注意，类似cnw,dnw,ynw的形式同样可以写为ncw,ndw,nyw。
7 替换

  * r: 替换光标处的字符，同样支持汉字。
    * R: 进入替换模式，按esc回到正常模式。

8 撤消与重做

    * [n] u: 取消一(n)个改动。
    * ctrl + r: 重做最后的改动。
    * U: 取消当前行中所有的改动。

9 剪切和复制、粘贴

* [n]x: 剪切光标右边n个字符，相当于d[n]l。
    * [n]X: 剪切光标左边n个字符，相当于d[n]h。
    * y: 复制在可视模式下选中的文本。
    * yy or Y: 复制整行文本。
    * y[n]w: 复制一(n)个词。
    * y[n]l: 复制光标右边1(n)个字符。
    * y[n]h: 复制光标左边1(n)个字符。
    * y$: 从光标当前位置复制到行尾。
    * y0: 从光标当前位置复制到行首。
    * :m,ny<cr> 复制m行到n行的内容。
    * y1G或ygg:复制光标以上的所有行。
    * yG: 复制光标以下的所有行。
    * d: 删除（剪切）在可视模式下选中的文本。
    * d$ or D: 删除（剪切）当前位置到行尾的内容。
    * d[n]w: 删除（剪切）1(n)个单词
    * d[n]l: 删除（剪切）光标右边1(n)个字符。
    * d[n]h: 删除（剪切）光标左边1(n)个字符。
    * d0: 删除（剪切）当前位置到行首的内容
    * [n] dd: 删除（剪切）1(n)行。
    * :m,nd<cr> 剪切m行到n行的内容。
    * d1G或dgg:剪切光标以上的所有行。
    * dG: 剪切光标以下的所有行。
    * p: 在光标之后粘贴。
    * P: 在光标之前粘贴。
10 查找和替换

    * /something: 在后面的文本中查找something。
    * ?something: 在前面的文本中查找something。
    * n: 向后查找下一个。
    * N: 向前查找下一个。
    * :s/old/new: 用new替换当前行第一个old。
    * :s/old/new/g: 用new替换当前行所有的old。
    * :n1,n2s/old/new/g: 用new替换文件n1行到n2行所有的old。
    * :%s/old/new/g: 用new替换文件中所有的old。
    * :%s/^/xxx/g: 在每一行的行首插入xxx，^表示行首。
    * :%s/$/xxx/g: 在每一行的行尾插入xxx，^表示行尾。
    * 所有替换命令末尾加上c，每个替换都将需要用户确认。如：%s/old/new/gc
    * %: 找到对应的([{.

11 多行缩进缩出

    * 正常模式下，按两下>;光标所在行会缩进。
    * 如果先按了n，再按两下>;，光标以下的n行会缩进。
    * 对应的，按两下<;，光标所在行会缩出。
    * 如果在编辑代码文件，可以用=进行调整。
    * 在可视模式下，选择要调整的代码块，按=，代码会按书写规则缩排好。
    * 或者n=，调整n行代码的缩排。

12 打开和关闭文档

    * :e file –关闭当前编辑的文件，并开启新的文件。如果对当前文件的修改未保存，vi会警告。
    * :e! file –放弃对当前文件的修改，编辑新的文件。
    * :e+file – 开始新的文件，并从文件尾开始编辑。
    * :e+n file – 开始新的文件，并从第n行开始编辑。
    * :enew –编译一个未命名的新文档。
    * :e – 重新加载当前文档。
    * :e! – 重新加载当前文档，并丢弃已做的改动。
    * :w – 保存修改。
    * :n1,n2w filename – 选择性保存从某n1行到另n2行的内容。
    * :wq – 保存并退出。
    * :x – 保存并退出。
    * :saveas newfilename – 另存为

13 多标签编辑

    * :tabe filename – 在新的标签中打开一个文件。
    * :tabn – 切换到下一个标签。
    * :tabp – 切换到上一个标签。

14 分屏编辑
14.1 水平分割

    * :split(:sp) – 把当前窗水平分割成两个窗口。
    * :split filename – 水平分割窗口，并在新窗口中显示另一个文件。
    * :nsplit(:nsp) – 水平分割出一个n行高的窗口。
    * :new – 水平分割出一个窗口，并编辑一个新文件。
    * ctrl+w + –当前窗口增高一行。也可以用n增高n行。
    * ctrl+w - –当前窗口减小一行。也可以用n减小n行。
    * ctrl+w _ –当前窗口扩展到尽可能的大。
    * n ctrl+w _ – 当前窗口的高度设定为n行。

14.2 垂直分割

    * :vsplit(:vsp) – 把当前窗口分割成水平分布的两个窗口。
    * :vnew – 垂直分割出一个新窗口。
    * :vertical 水平分割的命令：相应的垂直分割。

14.3 关闭子窗口

    * :qall – 关闭所有窗口，退出vim。
    * :wall – 保存所有修改过的窗口。
    * :only – 只保留当前窗口，关闭其它窗口。
    * :close – 关闭当前窗口。(象 :q :x同样工作 )
4.4 切换和移动窗口

［如果支持鼠标，切换和调整子窗口的大小就简单了。］

    * ctrl+w ctrl+w: 切换到下一个窗口。或者是ctrl+ww。
    * ctrl+w h(l,j,k):切换到左（右，下，上）的窗口。
    * ctrl+w t(b):切换到最上（下）面的窗口。<BR>
    * ctrl+w H(L,K,J): 将当前窗口移动到最左（右、上、下）面。

正因为vim强大的分屏功能，我们可以把vim打造成功能强大的IDE。
15 一次编辑多个文件

我们可以一次打开多个文件，如

vi a.txt b.txt c.txt

    * 使用:next(:n)编辑下一个文件。
    * 使用:previous编辑上一个文件。
    * 使用:wnext，保存当前文件，并编辑下一个文件。
    * 使用:wprevious，保存当前文件，并编辑上一个文件。
    * 使用:args显示文件列表。

16 文件的编码

    * :e ++enc=utf8 filename, 让vim用utf-8的编码打开这个文件。
    * :w ++enc=gbk，不管当前文件什么编码，把它转存成gbk编码。
    * :set fenc或:setfileencoding，查看当前文件的编码。
    * 在vimrc中添加setfileencoding=utf-8,cp936,ucs-bom，vim会根据要打开的文件选择合适的编码。注意：编码之间不要留空格。cp936对应于gbk编码。ucs-bom对应于windows下的文件格式。

让vim正确处理文件格式和文件编码，有赖于~/.vimrc的正确配置。
17 执行命令

    * :! cmd 执行外部命令。
    * :!! 执行上一次的外部命令。
    * @: 重复上一次的冒号命令。
    * :sh 调用shell，用exit返回vim。
    * :r !cmd 将命令的返回结果插入文件当前位置。
    * :m,nw !cmd 将文件的m行到n行之间的内容做为命令输入执行命令。

18 一些快捷键（收集中）

    * K: 打开光标所在词的manpage。
    * *: 向下搜索光标所在词。
    * #: 向上搜索光标所在词。
    * ~: 反转光标所在字符的大小写。
    * %: 移动到匹配的(),{}或[]上。
