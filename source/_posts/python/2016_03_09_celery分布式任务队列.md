---
title: Celery分布式任务队列
date: 2016-3-9 13:23
category:
	- Misc
tags:
	- celery
---
# Celery分布式任务队列

## Choosing a Broker

### RabbitMQ

### Redis

### Databbase([SQLAlchemy](http://docs.celeryproject.org/en/latest/getting-started/brokers/sqlalchemy.html#broker-sqlalchemy)/[Django Database](http://docs.celeryproject.org/en/latest/getting-started/brokers/django.html#broker-django))


### Create app

```
from celery import Celery

app = Celery('tasks', broker='amqp://guest@localhost//')

@app.task
def add(x, y):
    return x + y
```

### Create Celery Server

```
celery -A tasks worker --loglevel=info
```

### Call APP
```
>>> from tasks import add
>>> add.delay(4, 4)
```

### Results
如果你想保存结果

```
CELERY_RESULT_BACKEND = 'redis://localhost:6379/0'
```



## Task
通过使用装饰器task(),就可以创建一个task了.


### names
一种好的实践模式是使用模块名字当作人物名
```
>>> @app.task(name='tasks.add')
>>> def add(x, y):
...     return x + y
```


## Context
request contains information and state related to the executing task.
request的[属性](!http://docs.celeryproject.org/en/latest/userguide/tasks.html#context)

## Custom states

```
@app.task(bind=True)
def upload_files(self, filenames):
    for i, file in enumerate(filenames):
        if not self.request.called_directly:
            self.update_state(state='PROGRESS',
                meta={'current': i, 'total': len(filenames)})
```


## Designing Workflows
