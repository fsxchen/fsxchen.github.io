---
title: 装饰器
date: 2015-12-14 21:09
categories:
	- Python
tags:
	- Python
---

# 装饰器
装饰器是在python2.4之后新加入的.

如果没有装饰器
```python
#!/usr/bin/env python
#coding:utf-8

class WhatFor(object):
    def it(cls):
        print 'work with %s' % cls
    it = classmethod(it)
    def uncommon():
        print 'I could be a global function'


WhatFor.it()
# WhatFor.uncommon()
```

## 自定义的装饰器

```python

def mydecorator(function):
    def _mydecorator():
        return function(*args, **kw)
    return _mydecorator

```
测试代码运行时间的装饰器

```python
import time

def mydecorator(function):
    def _mydecorator(*args, **kw):
        start = time.time()
        res = function(*args, **kw)
        print time.time() - start
        return res
    return _mydecorator

# foo = mydecorator(foo)
@mydecorator
def foo():
    print 2**128

foo()
```

## 如何去掉装饰器的效果

```python
def mydecorator(function):
    @wraps(function)
    def _mydecorator(*args, **kw):
        start = time.time()
        res = function(*args, **kw)
        print(time.time() - start)
        return res
    return _mydecorator

# foo = mydecorator(foo)
@mydecorator
def foo():
    print(2**128)

foo()

orig_foo = foo.__wrapped__
orig_foo()

```
上面这个貌似在py3.x才生效

## 让装饰器带上参数
装饰器带上参数,需要在多加一层包裹的函数.
```
#!/usr/bin/env python
#coding: utf-8

def mydecorator(arg1, arg2):
	def _mydecorator(function):
		def __mydecorator(*args, **kw):
			# you can check the args before the function
			res = function(*args, **kw)
		return __mydecorator
	return _mydecorator
```


## 装饰器的应用场景

### 参数检查

### 缓存
关于与内部状态而不影响输出的函数,这种编程风格是函数型编程的重要特性.
缓存装饰器可以讲输出与计算它所需要的参数放在一起.也称为自动缓存,这个在递归的时候,很常用.有的也成为自动缓存或者是动态编程等.
### 代理

### 上下文提供者
